const insertRows = function (rowCount) {
  const grid = gridRef.value
  grid.stopEditing()
  grid.setGridOption('loading', true)

  // 1. 현재 적용된 필터 모델 가져오기
  const filterModel = grid.getFilterModel()
  const filterDefaults = {}

  // 필터 모델에서 단순 일치 조건(Set Filter 또는 Simple Filter의 equals) 추출
  Object.keys(filterModel).forEach((colId) => {
    const model = filterModel[colId]
    
    // Set Filter인 경우 (여러 값 선택 가능하므로 첫 번째 값 사용 혹은 무시 가능)
    if (model.filterType === 'set' && model.values.length > 0) {
      filterDefaults[colId] = model.values[0]
    } 
    // 일반 텍스트/숫자 필터인 경우 (완전 일치 조건일 때만)
    else if (model.filter === 'equals' || model.type === 'equals') {
      filterDefaults[colId] = model.filter
    }
  })

  const addRows = []
  for (let i = 0; i < rowCount; i++) {
    const newId = `new_${Math.random().toString(36).substring(2, 12)}`
    
    // 2. 기본 객체 생성
    const newRow = {
      STATUS: 'A',
      PROJ_NO: currentProjNo.value,
      ATT_ID: null,
      CL_ID: null,
      VAL_TYPE: VAL_TYPES.STRING.VALUE,
      RDON_YN: false,
      IGN_LIST_VAL: false,
      CRTER_NO: userInfo.value?.UserID,
      _id: newId,
      ...filterDefaults // 3. 필터링된 값을 덮어쓰기 (스프레드 연산자)
    }
    
    addRows.push(newRow)
  }

  if (addRows.length > 0) {
    // 필터링된 상태에서 새 행이 보이지 않을 수 있으므로, 
    // 보통 맨 위에 추가하거나 현재 표시된 행 개수를 기준으로 index 설정
    const lastIndex = grid.getDisplayedRowCount()
    const result = grid.applyTransaction({ add: addRows, addIndex: lastIndex })
    
    grid.refreshCells({ force: true, suppressFlash: true })
    grid.setNodesSelected({
      nodes: result.add,
      newValue: true,
    })
    grid.ensureIndexVisible(lastIndex, 'bottom')
  }
  grid.setGridOption('loading', false)
}
