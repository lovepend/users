const insertRows = function (rowCount) {
  const grid = gridRef.value
  grid.stopEditing()
  grid.setGridOption('loading', true)

  const filterModel = grid.getFilterModel()
  const filterDefaults = {}

  // 값을 찾을 때까지 수단과 방법을 가리지 않는 함수
  const findValueAnywhere = (obj) => {
    if (!obj || typeof obj !== 'object') return null;

    // 1. "filter" 키가 직접 있으면 즉시 반환 (가장 확실한 값)
    if (obj.filter !== undefined) return obj.filter;
    
    // 2. "values" 배열이 있으면 (Set Filter) 첫 번째 값 반환
    if (Array.isArray(obj.values) && obj.values.length > 0) return obj.values[0];

    // 3. "filterModels" 배열이 있으면 (Multi Filter) 내부를 순회하며 재귀 탐색
    if (Array.isArray(obj.filterModels)) {
      for (const subModel of obj.filterModels) {
        const val = findValueAnywhere(subModel);
        if (val !== null) return val;
      }
    }

    // 4. "conditions" 배열이 있으면 (복합 필터) 내부를 순회하며 재귀 탐색
    if (Array.isArray(obj.conditions)) {
      for (const cond of obj.conditions) {
        const val = findValueAnywhere(cond);
        if (val !== null) return val;
      }
    }

    // 5. "condition1" 또는 "condition2"가 있으면 탐색
    if (obj.condition1) return findValueAnywhere(obj.condition1);
    if (obj.condition2) return findValueAnywhere(obj.condition2);

    // 6. 기타 다른 명칭의 값들 체크
    return obj.value !== undefined ? obj.value :
           obj.filterFrom !== undefined ? obj.filterFrom :
           obj.dateFrom !== undefined ? obj.dateFrom : null;
  };

  // 모든 필터 컬럼 순회
  Object.keys(filterModel).forEach((colId) => {
    const val = findValueAnywhere(filterModel[colId]);
    if (val !== null && val !== undefined) {
      filterDefaults[colId] = val;
    }
  });

  console.log('최종 추출 결과 (filterDefaults):', filterDefaults);

  const addRows = []
  for (let i = 0; i < rowCount; i++) {
    const newId = `new_${Math.random().toString(36).substring(2, 12)}`
    const newRow = {
      STATUS: 'A',
      PROJ_NO: currentProjNo.value,
      ATT_ID: null,
      CL_ID: null,
      VAL_TYPE: VAL_TYPES.STRING.VALUE,
      RDON_YN: false,
      IGN_LIST_VAL: false,
      CRTER_NO: userInfo.value?.UserID,
      _id: newId,
      ...filterDefaults // 추출된 값 자동 주입
    }
    addRows.push(newRow)
  }

  if (addRows.length > 0) {
    const lastIndex = grid.getDisplayedRowCount()
    const result = grid.applyTransaction({ add: addRows, addIndex: lastIndex })
    
    grid.refreshCells({ force: true, suppressFlash: true })
    grid.setNodesSelected({ nodes: result.add, newValue: true })
    grid.ensureIndexVisible(lastIndex, 'bottom')
  }
  grid.setGridOption('loading', false)
}
