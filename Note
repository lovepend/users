const insertRows = function (rowCount) {
  const grid = gridRef.value;
  if (!grid) return;

  grid.stopEditing();
  grid.setGridOption('loading', true);

  const filterModel = grid.getFilterModel();
  const filterDefaults = {};

  const findValueAnywhere = (obj) => {
    if (!obj || typeof obj !== 'object') return null;
    let result = null;

    if (obj.filter !== undefined) result = obj.filter;
    else if (Array.isArray(obj.values)) result = obj.values[0];
    else if (Array.isArray(obj.filterModels)) {
      for (const sub of obj.filterModels) {
        const val = findValueAnywhere(sub);
        if (val !== null) { result = val; break; }
      }
    } else if (Array.isArray(obj.conditions)) {
      for (const cond of obj.conditions) {
        const val = findValueAnywhere(cond);
        if (val !== null) { result = val; break; }
      }
    } else {
      result = obj.condition1 ? findValueAnywhere(obj.condition1) :
               obj.value !== undefined ? obj.value : null;
    }

    // ★ 대문자 변환 처리: 확실하게 문자열임을 확인하고 변환
    if (result !== null && result !== undefined) {
      const stringVal = String(result).trim();
      return stringVal.toUpperCase(); // 무조건 대문자로 변환
    }
    return result;
  };

  Object.keys(filterModel).forEach((colId) => {
    const val = findValueAnywhere(filterModel[colId]);
    if (val !== null) {
      filterDefaults[colId] = val;
    }
  });

  // 콘솔로 변환된 값 최종 확인
  console.log('대문자로 변환된 필터값들:', filterDefaults);

  const addRows = [];
  const count = parseInt(rowCount) || 1;

  for (let i = 0; i < count; i++) {
    const newId = `new_${Math.random().toString(36).substring(2, 12)}`;
    
    // 1. 기본 객체 생성
    let newRow = {
      STATUS: 'A',
      PROJ_NO: currentProjNo.value,
      ATT_ID: null,
      CL_ID: null,
      VAL_TYPE: VAL_TYPES.STRING.VALUE,
      RDON_YN: false,
      IGN_LIST_VAL: false,
      CRTER_NO: userInfo.value?.UserID,
      _id: newId,
    };

    // 2. 필터 기본값을 명시적으로 할당 (덮어쓰기)
    // 스프레드 연산자(...filterDefaults)가 baseRow의 속성보다 뒤에 와야 함
    newRow = { ...newRow, ...filterDefaults };
    
    addRows.push(newRow);
  }

  if (addRows.length > 0) {
    const lastIndex = grid.getDisplayedRowCount();
    const result = grid.applyTransaction({ add: addRows, addIndex: lastIndex });
    
    grid.refreshCells({ force: true, suppressFlash: true });
    grid.setNodesSelected({ nodes: result.add, newValue: true });
    grid.ensureIndexVisible(lastIndex, 'bottom');
  }
  grid.setGridOption('loading', false);
};
