const insertRows = function (rowCount) {
  const grid = gridRef.value
  grid.stopEditing()
  grid.setGridOption('loading', true)

  const filterModel = grid.getFilterModel()
  const filterDefaults = {}

  // Multi Filter 및 Nested 구조를 모두 파고드는 함수
  const getDeepValue = (m) => {
    if (!m || typeof m !== 'object') return null

    // 1. Multi Filter 대응: filterModels 배열이 있으면 유효한 첫 번째 요소를 탐색
    if (m.filterType === 'multi' && Array.isArray(m.filterModels)) {
      const activeFilter = m.filterModels.find(f => f !== null);
      return getDeepValue(activeFilter);
    }

    // 2. 복합 조건 (AND/OR) 대응
    if (Array.isArray(m.conditions) && m.conditions.length > 0) {
      return getDeepValue(m.conditions[0]);
    }
    if (m.condition1) return getDeepValue(m.condition1);

    // 3. Set Filter 대응
    if (Array.isArray(m.values)) return m.values[0];

    // 4. 실제 값 추출 (보내주신 로그의 "filter" 키 포함)
    return m.filter !== undefined ? m.filter : 
           m.value !== undefined ? m.value : 
           m.filterFrom !== undefined ? m.filterFrom :
           m.dateFrom !== undefined ? m.dateFrom : null;
  }

  // 필터 모델 순회 및 값 추출
  Object.keys(filterModel).forEach((colId) => {
    const extractedValue = getDeepValue(filterModel[colId]);
    if (extractedValue !== null && extractedValue !== undefined) {
      filterDefaults[colId] = extractedValue;
    }
  });

  const addRows = []
  for (let i = 0; i < rowCount; i++) {
    const newId = `new_${Math.random().toString(36).substring(2, 12)}`
    const newRow = {
      STATUS: 'A',
      PROJ_NO: currentProjNo.value,
      ATT_ID: null,
      CL_ID: null,
      VAL_TYPE: VAL_TYPES.STRING.VALUE,
      RDON_YN: false,
      IGN_LIST_VAL: false,
      CRTER_NO: userInfo.value?.UserID,
      _id: newId,
      ...filterDefaults // 이제 GROUP: "test" 가 자동으로 들어갑니다.
    }
    addRows.push(newRow)
  }

  // 디버깅 로그
  console.log('추출된 필터 결과:', filterDefaults);

  if (addRows.length > 0) {
    const lastIndex = grid.getDisplayedRowCount()
    const result = grid.applyTransaction({ add: addRows, addIndex: lastIndex })
    
    grid.refreshCells({ force: true, suppressFlash: true })
    grid.setNodesSelected({ nodes: result.add, newValue: true })
    grid.ensureIndexVisible(lastIndex, 'bottom')
  }
  grid.setGridOption('loading', false)
}
